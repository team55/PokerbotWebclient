
<!-- Step title -->
<h1>Stap 3</h1>

<!-- Step description -->
<span id="step-3-description">
  <p> Wist je dat je ook een if statement in een if statement kunt plaatsen? We behouden
      de regel van stap twee, maar passen deze aan om te voldoen aan het volgende.
      Indien er wel degelijk een paar op tafel of in de hand ligt, dan moeten we
      een tweede check gaan uitvoeren. Deze houdt in dat indien er <b>strikt meer dan 3
      raises</b> geweest zijn, de bot zal callen. Indien dit niet het geval is,
      <b>raisen we naar de potgrootte</b>. Indien onze eerste voorwaarde (deze van
      het paar) niet voldaan is, zullen we <b>altijd folden</b>. Opmerking: Let er op
      dat je zeker geneste if statements gebruikt! </p>
      <div class="ui buttons">
        <button id="step-3-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-3-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-3-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> Deze stap was al een stuk moeilijker dan de voorgaande stappen, maar je bent
      er toch in geslaagd om deze tot een goed einde te brengen. In stap 4 gaan we
      eens kijken hoe we een moeilijkere hand kunnen definiÃ«ren. Daarna ben je er klaar
      voor en kunnen we je loslaten op de pokerbot! </p>
      <button class="ui small grey button" onclick="step3Checker.next()">
        Volgende stap!
      </button>
</span>

<!-- Step fail -->
<span id="step-3-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer het nu eens zelf! </p>
  <div><img width='150' class="solution" src="tutorials/3/solution.png" />
  </div>
  <button id="step-3-restart-btn" class="ui small grey button">
    Probeer opnieuw!
  </button>
</span>

<!-- Step tips -->
<div id="step-3-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p class="diminfo"> Het is mogelijk om gewoon een tweede if statement binnen
          een ander if statement te slepen. Gebruik voor dit tweede if statement
          nu een vergelijking tussen twee getallen ('aantal raises' en '3').
          Werk het if statement nu gewoon af zoals je in de vorige stappen hebt
          gedaan </p>
      <div id="step-3-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>

<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show3Description = function() {
    $('#step-3-description').show();
    $('#step-3-success').hide();
    $('#step-3-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show3Success = function() {
    $('#step-3-description').hide();
    $('#step-3-success').show();
    $('#step-3-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show3Fail = function() {
    $('#step-3-description').hide();
    $('#step-3-success').hide();
    $('#step-3-fail').show();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show3Tips = function() {
    $('#step-3-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide3Tips = function() {
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step3Checker = {
    isCompleted: false,
    complete: function() {
      if (!this.isCompleted) show3Success();
      this.isCompleted = true;
    },
    next: function() {
      show3Description();
      $('#bargraph').load('tutorials/4a/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  workspace.addChangeListener(function() {
    var solution1 = '<xml xmlns="http://www.w3.org/1999/xhtml"><block type="custom_if" x="18" y="30"><value name="IF0"><block type="poker_cards"><field name="in">allekaarten</field><value name="cardlist"><block type="poker_card"><value name="arg_color"><block type="poker_color_any"></block></value><value name="arg_rank"><block type="poker_rank_same"><value name="num"><block type="math_number"><field name="NUM">1</field></block></value></block></value><next><block type="poker_card"><value name="arg_color"><block type="poker_color_any"></block></value><value name="arg_rank"><block type="poker_rank_same"><value name="num"><block type="math_number"><field name="NUM">1</field></block></value></block></value></block></next></block></value></block></value><statement name="DO0"><block type="custom_if"><value name="IF0"><block type="greater_then"><value name="A"><block type="number_of_raises"></block></value><value name="B"><block type="math_number"><field name="NUM">3</field></block></value></block></value><statement name="DO0"><block type="poker_call"></block></statement><next><block type="poker_raise"><value name="amount"><block type="potsize"></block></value></block></next></block></statement><next><block type="poker_fold"></block></next></block></xml>';
    var solution2 = '<xml xmlns="http://www.w3.org/1999/xhtml"><block type="custom_if" x="18" y="30"><value name="IF0"><block type="poker_cards"><field name="in">allekaarten</field><value name="cardlist"><block type="poker_card"><value name="arg_color"><block type="poker_color_any"></block></value><value name="arg_rank"><block type="poker_rank_same"><value name="num"><block type="math_number"><field name="NUM">1</field></block></value></block></value><next><block type="poker_card"><value name="arg_color"><block type="poker_color_any"></block></value><value name="arg_rank"><block type="poker_rank_same"><value name="num"><block type="math_number"><field name="NUM">1</field></block></value></block></value></block></next></block></value></block></value><statement name="DO0"><block type="custom_if"><value name="IF0"><block type="less_then"><value name="A"><block type="math_number"><field name="NUM">3</field></block></value><value name="B"><block type="number_of_raises"></block></value></block></value><statement name="DO0"><block type="poker_call"></block></statement><next><block type="poker_raise"><value name="amount"><block type="potsize"></block></value></block></next></block></statement><next><block type="poker_fold"></block></next></block></xml>';
    var xml = Blockly.Xml.workspaceToDom(workspace);
    var provided = Blockly.Xml.domToText(xml);
    if (BlockChecker.equals(provided, solution1) || BlockChecker.equals(provided, solution2)) { step3Checker.complete(); }
  });

  $('#step-3-tips-btn').click(function(e) {
    show3Tips();
  });

  $('#step-3-hide-tips-btn').click(function(e) {
    hide3Tips();
  });

  $('#step-3-resign-btn').click(function(e) {
    show3Fail();
  });

  $('#step-3-restart-btn').click(function(e) {
    show3Description();
  });

</script>
