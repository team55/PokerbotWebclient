
<!-- Step title -->
<h1>Stap 3</h1>

<!-- Step preface -->
<span id="step-3-preface">
  <p> Wanneer je meerdere beslissingen wil nemen, is het mogelijk om dus ook
      meedere if statements toe te voegen aan je regel. Het is zelfs mogelijk
      om ze in elkaar te zetten! </p>
  <p> We zullen dit nu eens proberen door onze beslissing moeilijker te maken.
      <div class="ui buttons">
        <button id="step-3-preface-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<span id="step-3-part-1">
  <p> We kunnen nu proberen om onze call actie te vervangen door een hele nieuwe
      regel. In dit geval kunnen we gewoon een tweede if statement in het 'do' blok
      van het eerste if statement zetten en een nieuwe beslissing maken. </p>
  <p> Deze 'if' kan weer zijn eigen voorwaarden en acties hebben! </p>
      <div class="ui buttons">
        <button id="step-3-part-1-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<!-- Step description -->
<span id="step-3-description">
  <p> Zorg er nu voor dat de middenste 'if' aan de volgende eigenschappen voldoet.
      Welke actie wordt nu wanneer uitgevoerd? </p>
      <div class="ui bulleted list">
        <div class="item">  Indien het aantal raises strikt groter is dan 3: call.</div>
        <div class="item">  Anders: raise naar de potgrootte. </div>
      </div>
      <div class="ui buttons">
        <button id="step-3-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-3-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-3-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> Veel moeilijker als dit gaat het niet meer worden. In de volgende stap zullen
      we nog extra 'if' statements toevoegen. </p>
      <i class="huge yellow trophy icon"></i><br /><br /><br />
      <button class="ui small grey button" onclick="step3Checker.next()">
        Volgende stap!
      </button>
</span>

<!-- Step fail -->
<span id="step-3-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer nu eens zelf deze oplossing na te maken. Het is belangrijk dat je
      dit voorbeeld goed snapt voor de volgende stappen.</p>
  <div><img id="step-3-solution-preview" width='150' class="solution" src="tutorials/3/solution.png" />
  </div>
  <button id="step-3-restart-btn" class="ui small grey button">
    Probeer opnieuw!
  </button>
</span>

<!-- Step tips -->
<div id="step-3-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p id="step-3-tip-text" class="diminfo"></p>
      <div id="step-3-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>

<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show3Description = function() {
    $('#step-3-description').show();
    $('#step-3-success').hide();
    $('#step-3-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
    step3Checker.isStarted = true;
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show3Success = function() {
    $('#step-3-description').hide();
    $('#step-3-success').show();
    $('#step-3-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show3Fail = function() {
    $('#step-3-description').hide();
    $('#step-3-success').hide();
    $('#step-3-fail').show();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show3Tips = function() {
    $('#step-3-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide3Tips = function() {
    $('#step-3-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step3Checker = {
    isCompleted: false,
    isStarted: false,
    complete: function() {
      if (!this.isStarted) { return; }
      if (!this.isCompleted) {
        UIHANDLER.disableFullscreenWorkspace();
        show3Success();
      }
      this.isCompleted = true;
    },
    next: function() {
      show3Description();
      $('#bargraph').load('tutorials/4a/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  var solution31;
  var solution32;
  $.get('tutorials/3/solution1.xml', function(data) {
    solution31 = Utils.xmlToString(data);
    $.get('tutorials/3/solution2.xml', function(data) {
      solution32 = Utils.xmlToString(data);
      workspace.addChangeListener(function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        if (Utils.equalBlocks(provided, solution31) || Utils.equalBlocks(provided, solution32)) { step3Checker.complete(); }
      });
    });
  });

  $('#step-3-hide-tips-btn').click(function(e) {
    hide3Tips();
  });

  $('#step-3-resign-btn').click(function(e) {
    show3Fail();
  });

  $('#step-3-restart-btn').click(function(e) {
    show3Description();
  });

  $('#step-3-solution-preview').click(function(e) {
    $('#solution-zoom-img').attr('src', 'tutorials/3/solution.png');
    $('#solution-zoom').dimmer('show');
  });


    var step3Tips = [{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_cards/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'kaarthouder\' voorwaarde nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_cards/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'kaarthouder\' voorwaarden toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_card"/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'kaart\' voorwaarde nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_card"/g) || []).length;
          return count < 2;
        },
        text: 'Je hebt de \'kaart\' voorwaarde maar één keer toegevoegd aan je\
                  workspace. Deze heb je echter twee keer nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_card"/g) || []).length;
          return count > 2;
        },
        text: 'Je hebt te vaak de \'kaart\' voorwaarde toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar twee \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_rank_same"/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'Zelfde Groep (rank)\' voorwaarde nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_rank_same"/g) || []).length;
          return count < 2;
        },
        text: 'Je hebt de \'Zelfde Groep (rank)\' voorwaarde maar één keer toegevoegd aan je\
                  workspace. Deze heb je echter twee keer nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_rank_same"/g) || []).length;
          return count > 2;
        },
        text: 'Je hebt te vaak de \'Zelfde Groep (rank)\' voorwaarde toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar twee \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_call/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'call\' actie nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'acties\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_call/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'call\' acties toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_raise/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'raise\' actie nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'acties\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_raise/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'raise\' acties toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_fold/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'fold\' actie nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'acties\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_fold/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'fold\' acties toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/number_of_raises/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'aantal raises\' hoeveelheid nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'hoeveelheden\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/number_of_raises/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'aantal raises\' hoeveelheden toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/math_number/g) || []).length;
          return count < 3;
        },
        text: 'Je hebt de \'number\' hoeveelheid nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'hoeveelheden\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/math_number/g) || []).length;
          return count > 3;
        },
        text: 'Je hebt meerdere \'number\' hoeveelheden toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/potsize/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'potgrootte\' hoeveelheid nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'hoeveelheden\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/potsize/g) || []).length;
          return count > 1;
        },
        text: 'Je hebt meerdere \'potgrootte\' hoeveelheden toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var lc = (provided.match(/less_then/g) || []).length;
          var gc = (provided.match(/greater_then"/g) || []).length;
          var count = lc + gc;
          return count < 1;
        },
        text: 'Je hebt nog geen vergelijking toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'vergelijkingen\' in de toolbox aan de linkerkant. Gebruik de\
                  \'strikt groter\' of \'strikt kleiner\' vergelijking.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var lc = (provided.match(/less_then/g) || []).length;
          var gc = (provided.match(/greater_then"/g) || []).length;
          var count = lc + gc;
          return count > 1;
        },
        text: 'Je hebt meerdere vergelijkingen toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              vergelijking nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/custom_if/g) || []).length;
          return count < 1;
        },
        text: 'Je hebt de \'if\' nog niet toegevoegd aan je\
                  workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                  \'if\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/custom_if/g) || []).length;
          return count < 2;
        },
        text: 'Je hebt de \'if\' nog maar één keer toegevoegd aan je\
                  workspace. Deze heb je echter twee keer nodig. Je kan het vinden onder\
                  \'if\' in de toolbox aan de linkerkant.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/custom_if/g) || []).length;
          return count > 2;
        },
        text: 'Je hebt meer dan twee \'if\' statements toegevoegd aan je \
              workspace. Om deze opdracht te voltooien heb je echter maar één \
              keer dit blok nodig! Je kan de andere gerust verwijderen.'
      },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/block/g) || []).length;
          return count > 36;
        },
        text: ' Je hebt te veel blokken in je workspace, probeer er enkele te\
                verwijderen. Dit zal je workspace zo compact mogelijk houden.'
      },{
        valid: function() {
          return true;
        },
        text: ' Je hebt alle blokken al gevonden, je moet ze enkel nog op de juiste\
                manier in elkaar zien te puzzelen!'
      }
    ];

  $('#step-3-part-1').hide();
  $('#step-3-description').hide();
  $('#step-3-preface-btn').click(function(e) {
    $('#step-3-preface').hide();
    $('#step-3-part-1').show();
  });
  $('#step-3-part-1-btn').click(function(e) {
    $('#step-3-part-1').hide();
    show3Description();
  });

  $('#step-3-tips-btn').click(function(e) {
    for(var i = 0; i < step3Tips.length; i++) {
      var tip = step3Tips[i];
      if (tip.valid()) {
        $('#step-3-tip-text').html(tip.text);
        i = step3Tips.length;
      }
    }
    show3Tips();
  });

</script>
