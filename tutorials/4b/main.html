
<!-- Step title -->
<h1>Stap 4b</h1>

<!-- Step preface -->
<span id="step-4b-preface">
  <p> Denk eens even terug aan de manier waarop je een paar hebt gechecked. Indien twee
      kaarten dezelfde rank hebben, heb je een paar gevonden! </p>
  <p> Maar het probleem is dat indien we een three of een kind hebben, de voorwaarde van
      het paar ook waar zal zijn. Zie je waarom?
      <div class="ui buttons">
        <button id="step-4b-preface-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<span id="step-4b-part-1">
  <p> Dat is een probleem! Onze tweede check zal nooit uitgevoerd worden indien er
      een three of a kind ligt aangezien de eerste voorwaarde al waar was! </p>
  <p> Hoe lossen we dit op? </p>
      <div class="ui buttons">
        <button id="step-4b-part-1-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>


<span id="step-4b-part-2">
  <p> De voorwaarde van het paar vuurt dan wel wanneer er een three of a kind ligt,
      maar andersom nooit! Het is onmogelijk dat er drie dezelfde kaarten liggen,
      maar geen twee dezelfde. </p>
      <div class="ui buttons">
        <button id="step-4b-part-2-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<!-- Step description -->
<span id="step-4b-description">
  <p> Probeer nu de if statements van plaats te wisselen zodat dit probleem is
      opgelost. Hierna ben je klaar om het op te nemen tegen onze zelfgemaakte
      pokerbot! </p>
      <div class="ui buttons">
        <button id="step-4b-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-4b-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-4b-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> Je bent er helemaal klaar voor! Veel geluk! </p>
      <i class="huge yellow trophy icon"></i><br /><br /><br />
      <button class="ui small grey button" onclick="step4BChecker.next()">
        Laat maar komen!
      </button>
</span>

<!-- Step fail -->
<span id="step-4b-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer nu eens zelf deze oplossing na te maken. Het is belangrijk dat je
      dit voorbeeld goed snapt voor de volgende stappen.</p>
  <div><img id="step-4b-solution-preview" height='100' class="solution" src="tutorials/4b/solution.png" />
  </div>
  <button id="step-4b-restart-btn" class="ui small grey button">
    Probeer opnieuw!
  </button>
</span>

<!-- Step tips -->
<div id="step-4b-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p id="step-4b-tip-text" class="diminfo"></p>
      <div id="step-4b-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>

<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show4BDescription = function() {
    $('#step-4b-description').show();
    $('#step-4b-success').hide();
    $('#step-4b-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-4b-tips').dimmer('hide');
    step4BChecker.isStarted = true;
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show4BSuccess = function() {
    $('#step-4b-description').hide();
    $('#step-4b-success').show();
    $('#step-4b-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-4b-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show4BFail = function() {
    $('#step-4b-description').hide();
    $('#step-4b-success').hide();
    $('#step-4b-fail').show();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-4b-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show4BTips = function() {
    $('#step-4b-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide4BTips = function() {
    $('#step-4b-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step4BChecker = {
    isCompleted: false,
    isStarted: false,
    complete: function() {
      if (!this.isStarted) { return; }
      if (!this.isCompleted) {
        UIHANDLER.disableFullscreenWorkspace();
        show4BSuccess();
      }
      this.isCompleted = true;
    },
    next: function() {
      show4BDescription();
      $('#bargraph').load('tutorials/5/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  var solution4B1;
  var solution4B2;
  $.get('tutorials/4b/solution1.xml', function(data) {
    solution4B1 = Utils.xmlToString(data);
    $.get('tutorials/4b/solution2.xml', function(data) {
      solution4B2 = Utils.xmlToString(data);
      workspace.addChangeListener(function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        if (Utils.equalBlocks(provided, solution4B1) || Utils.equalBlocks(provided, solution4B2)) { step4BChecker.complete(); }
      });
    });
  });

  $('#step-4b-hide-tips-btn').click(function(e) {
    hide4BTips();
  });

  $('#step-4b-resign-btn').click(function(e) {
    show4BFail();
  });

  $('#step-4b-restart-btn').click(function(e) {
    show4BDescription();
  });

  $('#step-4b-solution-preview').click(function(e) {
    $('#solution-zoom-img').attr('src', 'tutorials/4b/solution.png');
    $('#solution-zoom').dimmer('show');
  });



  var step4BTips = [{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaarthouder\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_cards/g) || []).length;
          return count < 2;
        },
        text: 'Je hebt de \'kaarthouder\' voorwaarde nog maar één keer toegevoegd aan je\
                  workspace. Deze heb je echter twee keer nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count > 2;
      },
      text: 'Je hebt meerdere \'kaarthouder\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaart\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count < 5;
      },
      text: 'Je hebt nog niet genoeg \'kaart\' voorwaarden toegevoegd aan je\
                workspace. Deze heb je echter vijf keer nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count > 5;
      },
      text: 'Je hebt te vaak de \'kaart\' voorwaarde toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar vijf \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'Zelfde Groep (rank)\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count < 5;
      },
      text: 'Je hebt nog niet genoeg \'Zelfde Groep (rank)\' voorwaarden toegevoegd aan je\
                workspace. Deze heb je echter vijf keer nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count > 5;
      },
      text: 'Je hebt te vaak de \'Zelfde Groep (rank)\' voorwaarde toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar vijf \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'call\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'call\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'raise\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count < 2;
      },
      text: 'Je hebt maar één keer een \'raise\' actie toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je er echter twee nodig.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count > 2;
      },
      text: 'Je hebt meerdere \'raise\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar twee \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'fold\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'fold\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/number_of_raises/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'aantal raises\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/number_of_raises/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'aantal raises\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/math_number/g) || []).length;
        return count < 6;
      },
      text: 'Je hebt de \'number\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/math_number/g) || []).length;
        return count > 6;
      },
      text: 'Je hebt meerdere \'number\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/stacksize/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'stackgrootte\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/stacksize/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'stackgrootte\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/potsize/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'potgrootte\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/potsize/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'potgrootte\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var lc = (provided.match(/less_then/g) || []).length;
        var gc = (provided.match(/greater_then"/g) || []).length;
        var count = lc + gc;
        return count < 1;
      },
      text: 'Je hebt nog geen vergelijking toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'vergelijkingen\' in de toolbox aan de linkerkant. Gebruik de\
                \'strikt groter\' of \'strikt kleiner\' vergelijking.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var lc = (provided.match(/less_then/g) || []).length;
        var gc = (provided.match(/greater_then"/g) || []).length;
        var count = lc + gc;
        return count > 1;
      },
      text: 'Je hebt meerdere vergelijkingen toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            vergelijking nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'if\' nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 3;
      },
      text: 'Je hebt de \'if\' nog geen drie keer toegevoegd aan je\
                workspace. Deze heb je echter drie keer nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count > 3;
      },
      text: 'Je hebt meer dan drie \'if\' statements toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar drie \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/block/g) || []).length;
        return count > 68;
      },
      text: ' Je hebt te veel blokken in je workspace, probeer er enkele te\
              verwijderen. Dit zal je workspace zo compact mogelijk houden.'
    },{
      valid: function() {
        return true;
      },
      text: ' Je hebt alle blokken al gevonden, je moet ze enkel nog op de juiste\
              manier in elkaar zien te puzzelen!'
    }
  ];

  $('#step-4b-part-1').hide();
    $('#step-4b-part-2').hide();
  $('#step-4b-description').hide();
  $('#step-4b-preface-btn').click(function(e) {
    $('#step-4b-preface').hide();
    $('#step-4b-part-1').show();
  });
  $('#step-4b-part-1-btn').click(function(e) {
    $('#step-4b-part-1').hide();
    $('#step-4b-part-2').show();
  });
  $('#step-4b-part-2-btn').click(function(e) {
    $('#step-4b-part-2').hide();
    show4BDescription();
  });

  $('#step-4b-tips-btn').click(function(e) {
    for(var i = 0; i < step4BTips.length; i++) {
      var tip = step4BTips[i];
      if (tip.valid()) {
        $('#step-4b-tip-text').html(tip.text);
        i = step4BTips.length;
      }
    }
    show4BTips();
  });


</script>
