
<!-- Step title -->
<h1>Stap 4a</h1>

<!-- Step preface -->
<span id="step-4a-preface">
  <p> We willen, buiten te na te gaan of we een paar hebben, nu ook nagaan
      of we three of a kind hebben. Dit kunnen we doen door een nieuw if statement
      te nemen en tussen het buitenste if statement en de fold actie te plaatsen. </p>
  <p> Is de allereerste voorwaarde (deze van het paar) fout, dan zal het if statement
      er onder verder gaan. Exact wat we willen dus!
      <div class="ui buttons">
        <button id="step-4a-preface-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<span id="step-4a-part-1">
  <p> Een three of a kind maken lijkt zeer sterk op een paar. Het enige verschil
      is dat er nu drie kaarten gelijk moeten zijn aan elkaar in plaats van twee. </p>
  <p> We kunnen dus gewoon deze keer drie kaarten (met dezelfde rank) toevoegen
      in plaats van twee! </p>
      <div class="ui buttons">
        <button id="step-4a-part-1-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>


<!-- Step description -->
<span id="step-4a-description">
  <p> Het tweede if statement (en dus eigenlijk de tweede regel) moet voldoen
      aan de volgende voorwaarden: </p>
      <div class="ui bulleted list">
        <div class="item">  Indien ik een three of a kind heb, raise dan naar mijn stackgrootte. </div>
        <div class="item">  In elk ander geval: fold. </div>
      </div>
      <p> Merk op dat die laatste actie (de fold actie) er al staat! </p>
      <div class="ui buttons">
        <button id="step-4a-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-4a-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-4a-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> We zijn bijna klaar om de pokerbot te verslaan. Er is echter nog een probleem
      met deze regel. Dit zullen we oplossen in stap 4b. </p>
      <i class="huge yellow trophy icon"></i><br /><br /><br />
      <button class="ui small grey button" onclick="step4AChecker.next()">
        Volgende stap!
      </button>
</span>

<!-- Step fail -->
<span id="step-4a-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer nu eens zelf deze oplossing na te maken. Het is belangrijk dat je
      dit voorbeeld goed snapt voor de volgende stappen.</p>
  <div><img id="step-4a-solution-preview" height='100' class="solution" src="tutorials/4a/solution.png" />
  </div>
  <button id="step-4a-restart-btn" class="ui small grey button">
    Probeer opnieuw!
  </button>
</span>

<!-- Step tips -->
<div id="step-4a-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p id="step-4a-tip-text" class="diminfo"></p>
      <div id="step-4a-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>

<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show4ADescription = function() {
    $('#step-4a-description').show();
    $('#step-4a-success').hide();
    $('#step-4a-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-4a-tips').dimmer('hide');
    step4AChecker.isStarted = true;
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show4ASuccess = function() {
    $('#step-4a-description').hide();
    $('#step-4a-success').show();
    $('#step-4a-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-4a-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show4AFail = function() {
    $('#step-4a-description').hide();
    $('#step-4a-success').hide();
    $('#step-4a-fail').show();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-4a-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show4ATips = function() {
    $('#step-4a-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide4ATips = function() {
    $('#step-4a-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step4AChecker = {
    isCompleted: false,
    isStarted: false,
    complete: function() {
      if (!this.isStarted) { return; }
      if (!this.isCompleted) {
        UIHANDLER.disableFullscreenWorkspace();
        show4ASuccess();
      }
      this.isCompleted = true;
    },
    next: function() {
      show4ADescription();
      $('#bargraph').load('tutorials/4b/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  var solution4A1;
  var solution4A2;
  $.get('tutorials/4a/solution1.xml', function(data) {
    solution4A1 = Utils.xmlToString(data);
    $.get('tutorials/4a/solution2.xml', function(data) {
      solution4A2 = Utils.xmlToString(data);
      workspace.addChangeListener(function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        if (Utils.equalBlocks(provided, solution4A1) || Utils.equalBlocks(provided, solution4A2)) { step4AChecker.complete(); }
      });
    });
  });

  $('#step-4a-hide-tips-btn').click(function(e) {
    hide4ATips();
  });

  $('#step-4a-resign-btn').click(function(e) {
    show4AFail();
  });

  $('#step-4a-restart-btn').click(function(e) {
    show4ADescription();
  });

  $('#step-4a-solution-preview').click(function(e) {
    $('#solution-zoom-img').attr('src', 'tutorials/4a/solution.png');
    $('#solution-zoom').dimmer('show');
  });


  var step4ATips = [{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaarthouder\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
        valid: function() {
          var xml = Blockly.Xml.workspaceToDom(workspace);
          var provided = Blockly.Xml.domToText(xml);
          var count = (provided.match(/poker_cards/g) || []).length;
          return count < 2;
        },
        text: 'Je hebt de \'kaarthouder\' voorwaarde nog maar één keer toegevoegd aan je\
                  workspace. Deze heb je echter twee keer nodig. Je kan het vinden onder\
                  \'kaarten\' in de toolbox aan de linkerkant.'
      },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count > 2;
      },
      text: 'Je hebt meerdere \'kaarthouder\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaart\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count < 5;
      },
      text: 'Je hebt nog niet genoeg \'kaart\' voorwaarden toegevoegd aan je\
                workspace. Deze heb je echter vijf keer nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count > 5;
      },
      text: 'Je hebt te vaak de \'kaart\' voorwaarde toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar vijf \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'Zelfde Groep (rank)\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count < 5;
      },
      text: 'Je hebt nog niet genoeg \'Zelfde Groep (rank)\' voorwaarden toegevoegd aan je\
                workspace. Deze heb je echter vijf keer nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank_same"/g) || []).length;
        return count > 5;
      },
      text: 'Je hebt te vaak de \'Zelfde Groep (rank)\' voorwaarde toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar vijf \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'call\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'call\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'raise\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count < 2;
      },
      text: 'Je hebt maar één keer een \'raise\' actie toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je er echter twee nodig.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_raise/g) || []).length;
        return count > 2;
      },
      text: 'Je hebt meerdere \'raise\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar twee \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'fold\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'fold\' acties toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/number_of_raises/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'aantal raises\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/number_of_raises/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'aantal raises\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/math_number/g) || []).length;
        return count < 6;
      },
      text: 'Je hebt de \'number\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/math_number/g) || []).length;
        return count > 6;
      },
      text: 'Je hebt meerdere \'number\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/stacksize/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'stackgrootte\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/stacksize/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'stackgrootte\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/potsize/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'potgrootte\' hoeveelheid nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'hoeveelheden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/potsize/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'potgrootte\' hoeveelheden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var lc = (provided.match(/less_then/g) || []).length;
        var gc = (provided.match(/greater_then"/g) || []).length;
        var count = lc + gc;
        return count < 1;
      },
      text: 'Je hebt nog geen vergelijking toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'vergelijkingen\' in de toolbox aan de linkerkant. Gebruik de\
                \'strikt groter\' of \'strikt kleiner\' vergelijking.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var lc = (provided.match(/less_then/g) || []).length;
        var gc = (provided.match(/greater_then"/g) || []).length;
        var count = lc + gc;
        return count > 1;
      },
      text: 'Je hebt meerdere vergelijkingen toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            vergelijking nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'if\' nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 3;
      },
      text: 'Je hebt de \'if\' nog geen drie keer toegevoegd aan je\
                workspace. Deze heb je echter drie keer nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count > 3;
      },
      text: 'Je hebt meer dan drie \'if\' statements toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar drie \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/block/g) || []).length;
        return count > 68;
      },
      text: ' Je hebt te veel blokken in je workspace, probeer er enkele te\
              verwijderen. Dit zal je workspace zo compact mogelijk houden.'
    },{
      valid: function() {
        return true;
      },
      text: ' Je hebt alle blokken al gevonden, je moet ze enkel nog op de juiste\
              manier in elkaar zien te puzzelen!'
    }
  ];

  $('#step-4a-part-1').hide();
  $('#step-4a-description').hide();
  $('#step-4a-preface-btn').click(function(e) {
    $('#step-4a-preface').hide();
    $('#step-4a-part-1').show();
  });
  $('#step-4a-part-1-btn').click(function(e) {
    $('#step-4a-part-1').hide();
    show4ADescription();
  });

  $('#step-4a-tips-btn').click(function(e) {
    for(var i = 0; i < step4ATips.length; i++) {
      var tip = step4ATips[i];
      if (tip.valid()) {
        $('#step-4a-tip-text').html(tip.text);
        i = step4ATips.length;
      }
    }
    show4ATips();
  });

</script>
