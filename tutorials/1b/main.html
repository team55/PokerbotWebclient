
<!-- Step title -->
<h1>Stap 1b</h1>

<!-- Step preface -->
<span id="step-1b-preface">
  <p> Een programma gaat steeds regel per regels alles inlezen. Het if statement
      is daarvan een goed voorbeeld. Eerst wordt de voorwaarde ingelezen, daarna
      de actie indien aan deze voorwaarde voldaan is. </p>
  <p> Maar wat als dit niet het geval is? Da zal dit if statement het 'do'
      gedeelte overslaan en er onder verdergaan! </p>
      <div class="ui buttons">
        <button id="step-1b-preface-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<span id="step-1b-part-1">
  <p> De acties die onderaan een if statement worden geklikt worden dus altijd
      uitgevoerd, onafhankelijk van de voorwaade. De voorwaarde heeft dus enkel
      betrekking tot het 'do' gedeelte. </p>
  <p> Ons geval is echter iets anders dan de algemene vorm. Deze stopt
      altijd wanneer er een actie is uitgevoerd. Indien we bv de actie 'call'
      uitvoeren, is het volledig nutteloos om nog verder te gaan in de regel. </p>
      <div class="ui buttons">
        <button id="step-1b-part-1-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<!-- Step description -->
<span id="step-1b-description">
  <p> In ons geval wordt het tweede deel van het if statement dus enkel
      uitgevoerd indien er niet aan de voorwaarde voldaan is. Probeer nu eens regel te maken die als volgt te werk gaat. </p>
      <div class="ui bulleted list">
        <div class="item">  Indien het preflop is, call dan. </div>
        <div class="item">  Wanneer dit niet het geval is, fold. </div>
      </div>
      <div class="ui buttons">
        <button id="step-1b-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-1b-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-1b-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> Je begint het if statement al beter te begrijpen. We zullen in stap 1c
      eens proberen een voorwaarde op te stellen die gebaseerd is op kaarten. </p>
      <i class="huge yellow trophy icon"></i><br /><br /><br />
      <button class="ui small grey button" onclick="step1BChecker.next()">
        Volgende stap!
      </button>
</span>

<!-- Step fail -->
<span id="step-1b-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer nu eens zelf deze oplossing na te maken. Het is belangrijk dat je
      dit voorbeeld goed snapt voor de volgende stappen.</p>
      <div><img id="step-1b-solution-preview" height='100' class="solution" src="tutorials/1b/solution.png" />
      </div>
      <button id="step-1b-restart-btn" class="ui small grey button">
        Probeer opnieuw!
      </button>
</span>

<!-- Step tips -->
<div id="step-1b-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p id="step-1b-tip-text" class="diminfo"></p>
      <div id="step-1b-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>



<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show1BDescription = function() {
    $('#step-1b-description').show();
    $('#step-1b-success').hide();
    $('#step-1b-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-1b-tips').dimmer('hide');
    step1BChecker.isStarted = true;
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show1BSuccess = function() {
    $('#step-1b-description').hide();
    $('#step-1b-success').show();
    $('#step-1b-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-1b-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show1BFail = function() {
    $('#step-1b-description').hide();
    $('#step-1b-success').hide();
    console.log('e');
    $('#step-1b-fail').show();
    console.log('e');
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-1b-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show1BTips = function() {
    $('#step-1b-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide1BTips = function() {
    $('#step-1b-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step1BChecker = {
    isCompleted: false,
    isStarted: false,
    complete: function() {
      if (!this.isStarted) { return; }
      if (!this.isCompleted) {
        UIHANDLER.disableFullscreenWorkspace();
        show1BSuccess();
      }
      this.isCompleted = true;
    },
    next: function() {
      $('#bargraph').addClass('tutorialinfo');
      $('#bargraph').removeClass('tutorialsuccess');
      $('#bargraph').removeClass('tutorialfailed');
      $('#step-1b-tips').dimmer('hide');
      $('#bargraph').load('tutorials/1c/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  var solution1B;
  $.get('tutorials/1b/solution.xml', function(data) {
    solution1B = Utils.xmlToString(data);
    workspace.addChangeListener(function () {
      var xml = Blockly.Xml.workspaceToDom(workspace);
      var provided = Blockly.Xml.domToText(xml);
      if (Utils.equalBlocks(provided, solution1B)) { step1BChecker.complete(); }
    });
  });

  $('#step-1b-hide-tips-btn').click(function(e) {
    hide1BTips();
  });

  $('#step-1b-resign-btn').click(function(e) {
    show1BFail();
  });

  $('#step-1b-restart-btn').click(function(e) {
    show1BDescription();
  });

  var step1BTips = [{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/is_preflop/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'is preflop\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'voorwaarden\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/is_preflop/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'is preflop\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'call\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'call\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'fold\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'fold\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'if\' nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'if\' statements toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/block/g) || []).length;
        return count > 8;
      },
      text: ' Je hebt te veel blokken in je workspace, probeer er enkele te\
              verwijderen. Dit zal je workspace zo compact mogelijk houden.'
    },{
      valid: function() {
        return true;
      },
      text: ' Je hebt alle blokken al gevonden, je moet ze enkel nog op de juiste\
              manier in elkaar zien te puzzelen!'
    }
  ];

  $('#step-1b-solution-preview').click(function(e) {
    $('#solution-zoom-img').attr('src', 'tutorials/1b/solution.png');
    $('#solution-zoom').dimmer('show');
  });

  $('#step-1b-part-1').hide();
  $('#step-1b-description').hide();
  $('#step-1b-preface-btn').click(function(e) {
    $('#step-1b-preface').hide();
    $('#step-1b-part-1').show();
  });
  $('#step-1b-part-1-btn').click(function(e) {
    $('#step-1b-part-1').hide();
    show1BDescription();
  });

  $('#step-1b-tips-btn').click(function(e) {
    for(var i = 0; i < step1BTips.length; i++) {
      var tip = step1BTips[i];
      if (tip.valid()) {
        $('#step-1b-tip-text').html(tip.text);
        i = step1BTips.length;
      }
    }
    show1BTips();
  });


</script>
