
<!-- Step title -->
<h1>Stap 1c</h1>

<!-- Step preface -->
<span id="step-1c-preface">
  <p> Een voorwaarde gebaseerd op kaarten, wat is dat nu juist? Herinner je je nog
      de voorwaarden van in de introductie? We zullen er nog eens enkele opsommen: </p>
      <div class="ui bulleted list">
        <div class="item">  Het regent. </div>
        <div class="item">  Mijn pull is blauw. </div>
        <div class="item">  Ik heb twee Azen. </div>
        <div class="item">  Ik heb een Queen of hoger in mijn hand. </div>
      </div>
      <div class="ui buttons">
        <button id="step-1c-preface-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>

<span id="step-1c-part-1">
  <p> Om een voorwaarde te specifiëren in verband met kaarten, moeten we gebruik
      maken van de 'kaartenhouder'. Dit is het eerste blok in de 'kaarten' sectie.  </p>
  <p> Je kan hier heel simpel kaarten aan toevoegen om de voorwaarde specifieker
      te maken. Kan je zelf vinden hoe je ook de rank van de kaart bepaald? </p>
      <div class="ui buttons">
        <button id="step-1c-part-1-btn" class="ui teal button">
          Verder
        </button>
      </div>
</span>


<!-- Step description -->
<span id="step-1c-description">
  <p> Dit laatste voorbeeld is eentje dat we gaan namaken. We willen de volgende
      regel bekomen: </p>
      <div class="ui bulleted list">
        <div class="item">  Indien ik een Queen of hoger in mijn hand heb, call. </div>
        <div class="item">  In elk ander geval: fold. </div>
      </div>
      <div class="ui buttons">
        <button id="step-1c-tips-btn" class="ui green button">
          Toon tip
        </button>
        <div class="or" data-text="of"></div>
        <button id="step-1c-resign-btn" class="ui red button">
          Geef op
        </button>
      </div>
</span>

<!-- Step success -->
<span id="step-1c-success">
  <span class="congrats">Gefeliciteerd!</span>
  <p> Je hebt net je eerste op kaarten gebaseerde situatie gemaakt! Laten we
      deze kennis in de volgende stappen uitbreiden. </p>
      <i class="huge yellow trophy icon"></i><br /><br /><br />
      <button class="ui small grey button" onclick="step1CChecker.next()">
        Volgende stap!
      </button>
</span>

<!-- Step fail -->
<span id="step-1c-fail">
  <span class="congrats">Oops!</span>
  <p> Probeer nu eens zelf deze oplossing na te maken. Het is belangrijk dat je
      dit voorbeeld goed snapt voor de volgende stappen.</p>
      <div><img id="step-1c-solution-preview" height='100' class="solution" src="tutorials/1c/solution.png" />
      </div>
      <button id="step-1c-restart-btn" class="ui small grey button">
        Probeer opnieuw!
      </button>
</span>

<!-- Step tips -->
<div id="step-1c-tips" class="ui dimmer">
  <div class="content">
    <div class="center">
      <h2 class="ui inverted icon header">
        <i class="help icon"></i>
        Tip
      </h2>
      <p id="step-1c-tip-text" class="diminfo"></p>
      <div id="step-1c-hide-tips-btn" class="ui grey button">
        Bedankt!
      </div>
    </div>
  </div>
</div>

<script>

  /**
   *  Shows the description div and hides all others, updates CSS.
   */
  var show1CDescription = function() {
    $('#step-1c-description').show();
    $('#step-1c-success').hide();
    $('#step-1c-fail').hide();
    $('#bargraph').addClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-1c-tips').dimmer('hide');
    step1CChecker.isStarted = true;
  }

  /**
   *  Shows the success div and hides all others, updates CSS.
   */
  var show1CSuccess = function() {
    $('#step-1c-description').hide();
    $('#step-1c-success').show();
    $('#step-1c-fail').hide();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').addClass('tutorialsuccess');
    $('#bargraph').removeClass('tutorialfailed');
    $('#step-1c-tips').dimmer('hide');
  }

  /**
   *  Shows the fail div and hides all others, updates CSS.
   */
  var show1CFail = function() {
    $('#step-1c-description').hide();
    $('#step-1c-success').hide();
    $('#step-1c-fail').show();
    $('#bargraph').removeClass('tutorialinfo');
    $('#bargraph').removeClass('tutorialsuccess');
    $('#bargraph').addClass('tutorialfailed');
    $('#step-1c-tips').dimmer('hide');
  }

  /**
   *  Shows the tips view.
   */
  var show1CTips = function() {
    $('#step-1c-tips').dimmer('show');
  }

  /**
   *  Hides the tips view.
   */
  var hide1CTips = function() {
    $('#step-1c-tips').dimmer('hide');
  }

  /**
   *  Checks if the step is completed and makes sure it does not happen
   *  multiple times.
   */
  var step1CChecker = {
    isCompleted: false,
    isStarted: false,
    complete: function() {
      if (!this.isStarted) { return; }
      if (!this.isCompleted) {
        UIHANDLER.disableFullscreenWorkspace();
        show1CSuccess();
      }
      this.isCompleted = true;
    },
    next: function() {
      show1CDescription();
      $('#bargraph').load('tutorials/2/main.html');
    }
  }

  /**
   *  Add listener to check if the new blocks are correct for this step.
   */
  var solution1C;
  $.get('tutorials/1c/solution.xml', function(data) {
    solution1C = Utils.xmlToString(data);
    workspace.addChangeListener(function () {
      var xml = Blockly.Xml.workspaceToDom(workspace);
      var provided = Blockly.Xml.domToText(xml);
      if (Utils.equalBlocks(provided, solution1C)) { step1CChecker.complete(); }
    });
  });

  $('#step-1c-tips-btn').click(function(e) {
    show1CTips();
  });

  $('#step-1c-hide-tips-btn').click(function(e) {
    hide1CTips();
  });

  $('#step-1c-resign-btn').click(function(e) {
    show1CFail();
  });

  $('#step-1c-restart-btn').click(function(e) {
    show1CDescription();
  });

  $('#step-1c-solution-preview').click(function(e) {
    $('#solution-zoom-img').attr('src', 'tutorials/1c/solution.png');
    $('#solution-zoom').dimmer('show');
  });

  var step1CTips = [{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaarthouder\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_cards/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'kaarthouder\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'kaart\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_card"/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'kaart\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank"/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'rank\' voorwaarde nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'kaarten\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_rank"/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'rank\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'call\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_call/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'call\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'fold\' actie nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'acties\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/poker_fold/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'fold\' voorwaarden toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count < 1;
      },
      text: 'Je hebt de \'if\' nog niet toegevoegd aan je\
                workspace. Deze heb je echter wel nodig. Je kan het vinden onder\
                \'if\' in de toolbox aan de linkerkant.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/custom_if/g) || []).length;
        return count > 1;
      },
      text: 'Je hebt meerdere \'if\' statements toegevoegd aan je \
            workspace. Om deze opdracht te voltooien heb je echter maar één \
            keer dit blok nodig! Je kan de andere gerust verwijderen.'
    },{
      valid: function() {
        var xml = Blockly.Xml.workspaceToDom(workspace);
        var provided = Blockly.Xml.domToText(xml);
        var count = (provided.match(/block/g) || []).length;
        return count > 14;
      },
      text: ' Je hebt te veel blokken in je workspace, probeer er enkele te\
              verwijderen. Dit zal je workspace zo compact mogelijk houden.'
    },{
      valid: function() {
        return true;
      },
      text: ' Je hebt alle blokken al gevonden, je moet ze enkel nog op de juiste\
              manier in elkaar zien te puzzelen!'
    }
  ];

  $('#step-1c-part-1').hide();
  $('#step-1c-description').hide();
  $('#step-1c-preface-btn').click(function(e) {
    $('#step-1c-preface').hide();
    $('#step-1c-part-1').show();
  });
  $('#step-1c-part-1-btn').click(function(e) {
    $('#step-1c-part-1').hide();
    show1CDescription();
  });

  $('#step-1c-tips-btn').click(function(e) {
    for(var i = 0; i < step1CTips.length; i++) {
      var tip = step1CTips[i];
      if (tip.valid()) {
        $('#step-1c-tip-text').html(tip.text);
        i = step1CTips.length;
      }
    }
    show1CTips();
  });

</script>
